{
    "description": "Normalized Curriculum Learning - Uses reward_scale_factors to balance reward magnitudes",
    "total_timesteps": 3e7,
    "evaluate_param_list":[
        {
            "num_timesteps": 200,
            "min_target_velocity": 0.8,
            "max_target_velocity": 0.8,
            "target_velocity_period": 2,
            "velocity_mode": "UNIFORM",
            "cam_type": "follow",
            "cam_distance": 2.5,
            "visualize_activation": true
        }
    ],
    "logger_params": {
        "logging_frequency": 8,
        "evaluate_frequency": 732
    },
    "env_params": {
        "env_id": "myoAssistLegImitation-v0",
        "num_envs": 8,
        "seed": 1234,
        "safe_height": 0.7,
        "out_of_trajectory_threshold": 0.6,
        "flag_random_ref_index": true,
        "control_framerate": 30,
        "physics_sim_framerate": 1200,

        "min_target_velocity": 0.8,
        "max_target_velocity": 0.8,
        "min_target_velocity_period": 2,
        "max_target_velocity_period": 10,

        "enable_lumbar_joint": false,
        "lumbar_joint_fixed_angle": -0.13,
        "lumbar_joint_damping_value": 0.05,

        "terrain_type": "flat",
        
        "reward_keys_and_weights": {
            "qpos_imitation_rewards": {
                "pelvis_tx": 0.0,
                "pelvis_ty": 0.00001,
                "pelvis_tz": 0.00001,
                "pelvis_tilt": 0.00001,
                "pelvis_list": 0.00001,
                "pelvis_rotation": 0.00001,
                "hip_flexion_l": 0.00001,
                "hip_flexion_r": 0.00001,
                "hip_adduction_l": 0.00001,
                "hip_adduction_r": 0.00001,
                "hip_rotation_l": 0.00001,
                "hip_rotation_r": 0.00001,
                "knee_angle_l": 0.00001,
                "knee_angle_r": 0.00001,
                "ankle_angle_l": 0.00001,
                "ankle_angle_r": 0.00001
            },
            "qvel_imitation_rewards": {
                "pelvis_tx": 0.0,
                "pelvis_ty": 0.00001,
                "pelvis_tz": 0.00001,
                "pelvis_tilt": 0.00001,
                "pelvis_list": 0.00001,
                "pelvis_rotation": 0.00001,
                "hip_flexion_l": 0.00001,
                "hip_flexion_r": 0.00001,
                "hip_adduction_l": 0.00001,
                "hip_adduction_r": 0.00001,
                "hip_rotation_l": 0.00001,
                "hip_rotation_r": 0.00001,
                "knee_angle_l": 0.00001,
                "knee_angle_r": 0.00001,
                "ankle_angle_l": 0.00001,
                "ankle_angle_r": 0.00001
            },
            "end_effector_imitation_reward": 0.0,
            "forward_reward": 1.0,
            "muscle_activation_penalty": 0.0000001,
            "muscle_activation_diff_penalty": 0.0000001,

            "footstep_delta_time": 0.0,
            "average_velocity_per_step": 0.0,
            "muscle_activation_penalty_per_step": 0.0,

            "foot_force_penalty": 0.00001
        },
        "custom_max_episode_steps": 1000,
        "model_path": "models/26muscle_3D/myoLeg26_BASELINE.xml",
        "reference_data_path": "rl_train/reference_data/S004_reference.npz",
        "reference_data_keys": ["ankle_angle_l", "ankle_angle_r",
                                "hip_flexion_l", "hip_flexion_r",
                                "hip_adduction_l", "hip_adduction_r",
                                "hip_rotation_l", "hip_rotation_r",
                                "knee_angle_l", "knee_angle_r",
                                "pelvis_tilt", "pelvis_list", "pelvis_rotation",
                                "pelvis_tx", "pelvis_ty", "pelvis_tz"],
        "prev_trained_policy_path": null
    },
    "ppo_params": {
        "learning_rate": 0.0001,
        "n_steps": 256,
        "batch_size": 8192,
        "n_epochs": 30,
        "gamma": 0.99,
        "gae_lambda": 0.95,
        "clip_range": 0.2,
        "clip_range_vf": 100,
        "ent_coef": 0.001,
        "vf_coef": 0.5,
        "max_grad_norm": 0.5,
        "use_sde": false,
        "sde_sample_freq": -1,
        "target_kl": 0.01,

        "device": "cuda"
    },
    "policy_params": {
        "custom_policy_params": {
            "net_arch": {
                        "human_actor": [64, 64],
                        "common_critic": [64, 64]
                    },
            "net_indexing_info": {
                "human_actor":
                {
                    "observation":
                        [
                            {
                                "type":"range",
                                "range":[0,15],
                                "comment":"15 qpos without lumbar_extension (3D: +6 pelvis DOF, +6 hip DOF)"
                            },
                            {
                                "type":"range",
                                "range":[15,31],
                                "comment":"16 qvel without lumbar_extension (3D: +6 pelvis DOF, +6 hip DOF)"
                            },
                            {
                                "type":"range",
                                "range":[31,57],
                                "comment":"26 muscle activation"
                            },
                            {
                                "type":"range",
                                "range":[57,58],
                                "comment":"target velocity"
                            }
                        ],
                    "action":
                        [
                            {
                                "type":"range_mapping",
                                "range_net":[0,26],
                                "range_action":[0,26],
                                "comment":"26 muscle activation without lumbar_extension(index: 29), exo"
                            }
                        ]
                },
                "common_critic": 
                {
                    "observation":
                    [
                        {
                            "type":"range",
                            "range":[0,15],
                            "comment":"15 qpos without lumbar_extension (3D: +6 pelvis DOF, +6 hip DOF)"
                        },
                        {
                            "type":"range",
                            "range":[15,31],
                            "comment":"16 qvel without lumbar_extension (3D: +6 pelvis DOF, +6 hip DOF)"
                        },
                        {
                            "type":"range",
                            "range":[31,57],
                            "comment":"26 muscle activation"
                        },
                        {
                            "type":"range",
                            "range":[57,58],
                            "comment":"target velocity"
                        }
                    ]
                }
            },
            "log_std_init": 0.0
        }
    },
    "auto_reward_adjust_params":{
        "learning_rate": 0.0
    },
    "reward_scale_factors": {
        "description": "Scale factors to normalize rewards to similar magnitudes",
        "qpos_imitation_scale": 0.00001,
        "qvel_imitation_scale": 0.00001,
        "forward_reward_scale": 1.0,
        "muscle_penalty_scale": 0.0000001,
        "foot_force_penalty_scale": 0.00001,
        "rationale": "Raw imitation rewards ~100k per rollout, forward ~0.5 per rollout. These scales bring them to similar order of magnitude."
    },
    "curriculum_params": {
        "enabled": true,
        "phase1_end": 0.3,
        "phase2_end": 0.7,
        "forward_weight_schedule": [5.0, 3.0, 1.5, 1.0],
        "imitation_pos_weight_schedule": [0.1, 0.3, 0.7, 1.0],
        "imitation_vel_weight_schedule": [0.1, 0.3, 0.7, 1.0],
        "description": {
            "UPDATED": "Extreme curriculum to force balancing first",
            "normalization": "Imitation reward seems ~1000x larger than forward",
            "solution": "Start imitation at 0.001x, forward at 10x",
            "phase1": "0-40%: Pure Balancing (forward=10.0, imitation=0.001)",
            "phase2": "40-80%: Transition (forward=2.0, imitation=0.1)",
            "phase3": "80-100%: Imitation (forward=1.0, imitation=1.0)",
            "rationale": "Force learning to walk/balance before imitating motion"
        }
    },
    "wandb_params": {
        "enabled": true,
        "project": "IL_Curriculum_Learning_Lab",
        "entity": null,
        "run_name": "curriculum_01_lab",
        "tags": ["curriculum", "3D", "S004", "normalized", "treadmill_0.8mps"],
        "notes": "Stand start + Curriculum (balanced 1:1:1) + Treadmill 0.8m/s"
    }
}
